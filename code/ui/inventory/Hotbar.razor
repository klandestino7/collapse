@using System;
@using Sandbox;
@using Sandbox.UI;
@using NxtStudio.Collapse;

@namespace NxtStudio.Collapse.UI
@attribute [StyleSheet( "/ui/inventory/Hotbar.scss" )]
@inherits Panel

@if ( !CollapsePlayer.Me.IsValid() ) return;

@{
    var hotbar = CollapsePlayer.Me.Hotbar;
    if ( !hotbar.IsValid() ) return;
}

<root>
    @for ( ushort i = 0; i < hotbar.SlotLimit; i++ )
    {
        var item = hotbar.GetFromSlot( i );
        var index = i;

        <InventorySlot IsSelected=@(GetHotbarIndex() == i) Container=@hotbar Slot=@i DisplaySlot=@(i + 1)></InventorySlot>
    }
</root>

@code
{
    //bool isHideHotbar = false;

    public Hotbar()
    {
        BindClass( "hidden", IsHidden );
    }

    protected override int BuildHash()
    {
        if ( !CollapsePlayer.Me.IsValid() ) return 0;
        return HashCode.Combine( CollapsePlayer.Me, CollapsePlayer.Me?.Hotbar, GetHotbarIndex() );
    }

    private int GetHotbarIndex()
    {
        return CollapsePlayer.Me?.HotbarIndex ?? -1;
    }

    private bool IsHidden()
    {
        if ( Game.LocalPawn.LifeState == LifeState.Dead )
            return true;

        if ( Dialog.IsActive() )
            return true;

        <!-- Log.Info( $"HideHotbar {isHideHotbar} "); -->
        return false;
    }
}
